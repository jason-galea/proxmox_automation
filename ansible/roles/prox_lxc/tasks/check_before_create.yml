- name: "Check if container is already running"
  delegate_to: prox
  vars: ### NOTE: Workaround for when the container isn't responding
    ansible_ssh_private_key_file: "{{ hostvars['prox'].ansible_ssh_private_key_file }}"
  ansible.builtin.shell:
    cmd: |
      set -o pipefail
      pct list | grep -E '{{ id }}\ *running'
    executable: /bin/bash
  register: check_if_ct_exists
  changed_when: check_if_ct_exists.rc != 0
  failed_when: false ### Ignore failures, we just want the stdout

- name: "Include role 'prox_lxc' with tasks from 'create' & 'install_packages'"
  loop:
    - create
    - install_packages
  ansible.builtin.include_role:
    name: prox_lxc
    tasks_from: "{{ item }}"
  when: check_if_ct_exists.stdout == ""
